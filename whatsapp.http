### ============================================
### ğŸŸ¢ WHATSAPP API - Tests REST Client
### ============================================
### Extension requise: REST Client (humao.rest-client)
### ============================================

@baseUrl = http://localhost:3001/api
@contentType = application/json

### ============================================
### ğŸ“± CONNEXION WHATSAPP
### ============================================

### 1. Obtenir le statut de connexion
GET {{baseUrl}}/whatsapp/status

### 2. Connecter WhatsApp (obtenir le pairing code)
POST {{baseUrl}}/whatsapp/connect
Content-Type: {{contentType}}

{
  "phoneNumber": "237697839130"
}

### 3. DÃ©connecter WhatsApp
DELETE {{baseUrl}}/whatsapp/disconnect

### ============================================
### ğŸ’¬ ENVOI DE MESSAGES
### ============================================

### 4. Envoyer un message simple
POST {{baseUrl}}/whatsapp/send
Content-Type: {{contentType}}

{
  "to": "237657857548",
  "message": "ğŸ° Bonjour  ! Ceci est un message de test depuis l'API."
}

### 5. Envoyer un message Ã  plusieurs destinataires (broadcast)
POST {{baseUrl}}/whatsapp/send-bulk
Content-Type: {{contentType}}

{
  "recipients": [
    "237657857548",
    "33760992973",
    "237696459553"
  ],
  "message": "ğŸ‰ Message groupÃ© de test provenant de l'API SBM (ManiX)!"
}

### ============================================
### ğŸ“… MESSAGES PROGRAMMÃ‰S
### ============================================

### 6. CrÃ©er un message programmÃ© (1 destinataire)
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ° Bonjour ! Votre commande #123 est prÃªte Ã  Ãªtre rÃ©cupÃ©rÃ©e.",
  "type": "TEXT",
  "scheduledAt": "2026-01-08T13:25:00Z",
  "recipients": [
    {
      "recipient": "237657857548",
      "type": "PRIVATE"
    }
  ]
}

### 7. CrÃ©er un message programmÃ© (plusieurs destinataires)
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ‰ Nouvelle promotion cette semaine ! -20% sur tous les gÃ¢teaux.",
  "type": "TEXT",
  "scheduledAt": "2026-01-08T16:00:00Z",
  "recipients": [
    {
      "recipient": "237699999999",
      "type": "PRIVATE"
    },
    {
      "recipient": "237688888888",
      "type": "PRIVATE"
    },
    {
      "recipient": "237677777777",
      "type": "PRIVATE"
    }
  ]
}

### 8. CrÃ©er un message programmÃ© pour un groupe
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ‘¥ Message pour le groupe !",
  "type": "TEXT",
  "scheduledAt": "2026-01-08T17:00:00Z",
  "recipients": [
    {
      "recipient": "120363XXXXXXXXX@g.us",
      "type": "GROUP"
    }
  ]
}

### 9. CrÃ©er un message programmÃ© dans 2 minutes (test rapide)
# @name createScheduledMessage
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "â° Message programmÃ© pour dans 2 minutes !",
  "type": "TEXT",
  "scheduledAt": "{{$datetime rfc1123 120}}",
  "recipients": [
    {
      "recipient": "237657857548",
      "type": "PRIVATE"
    }
  ]
}

### 10. Lister tous les messages programmÃ©s
GET {{baseUrl}}/whatsapp/scheduler

### 11. Lister les messages programmÃ©s par statut (PENDING)
GET {{baseUrl}}/whatsapp/scheduler?status=PENDING

### 12. Lister les messages programmÃ©s par statut (SENT)
GET {{baseUrl}}/whatsapp/scheduler?status=SENT

### 13. Lister les messages programmÃ©s par statut (FAILED)
GET {{baseUrl}}/whatsapp/scheduler?status=FAILED

### 14. Lister les 10 derniers messages programmÃ©s
GET {{baseUrl}}/whatsapp/scheduler?limit=10

### 15. Obtenir les statistiques
GET {{baseUrl}}/whatsapp/scheduler/stats

### 16. Annuler un message programmÃ©
# Remplacer {scheduleId} par l'ID rÃ©el
DELETE {{baseUrl}}/whatsapp/scheduler/{scheduleId}

### 17. Forcer l'exÃ©cution du cron maintenant (test)
POST {{baseUrl}}/whatsapp/scheduler/trigger-now

### ============================================
### ğŸ“Š GROUPES WHATSAPP (Ã‰tape 3 - Ã€ venir)
### ============================================

### 18. Lister tous les groupes WhatsApp
GET {{baseUrl}}/whatsapp/groups

### 19. Obtenir les dÃ©tails d'un groupe
# Remplacer {groupId} par l'ID rÃ©el
GET {{baseUrl}}/whatsapp/groups/{groupId}

### 20. Obtenir les participants d'un groupe
# Remplacer {groupId} par l'ID rÃ©el
GET {{baseUrl}}/whatsapp/groups/{groupId}/participants

### 21. Envoyer un message Ã  un groupe
POST {{baseUrl}}/whatsapp/groups/send
Content-Type: {{contentType}}

{
  "groupId": "120363XXXXXXXXX@g.us",
  "message": "ğŸ‘¥ Message pour tout le groupe !"
}

### 22. Synchroniser les groupes avec la DB
POST {{baseUrl}}/whatsapp/groups/sync

### ============================================
### ğŸ¤– RÃ‰PONSES AUTOMATIQUES (Ã‰tape 4 - Ã€ venir)
### ============================================

### 23. CrÃ©er une rÃ©ponse automatique
POST {{baseUrl}}/whatsapp/auto-reply
Content-Type: {{contentType}}

{
  "keyword": "prix",
  "response": "Nos prix commencent Ã  partir de 5000 FCFA. Consultez notre catalogue : www.exemple.com/prix",
  "isActive": true
}

### 24. Lister toutes les rÃ©ponses automatiques
GET {{baseUrl}}/whatsapp/auto-reply

### 25. Activer/DÃ©sactiver une rÃ©ponse automatique
# Remplacer {replyId} par l'ID rÃ©el
PATCH {{baseUrl}}/whatsapp/auto-reply/{replyId}/toggle

### 26. Supprimer une rÃ©ponse automatique
# Remplacer {replyId} par l'ID rÃ©el
DELETE {{baseUrl}}/whatsapp/auto-reply/{replyId}

### ============================================
### ğŸ“ˆ STATISTIQUES & MONITORING
### ============================================

### 27. Obtenir les statistiques globales
GET {{baseUrl}}/whatsapp/stats

### 28. Historique des messages envoyÃ©s (24h)
GET {{baseUrl}}/whatsapp/history?period=24h

### 29. Historique des messages envoyÃ©s (7 jours)
GET {{baseUrl}}/whatsapp/history?period=7d

### 30. Historique des messages envoyÃ©s (30 jours)
GET {{baseUrl}}/whatsapp/history?period=30d

### ============================================
### ğŸ¯ TESTS SPÃ‰CIFIQUES PÃ‚TISSERIE
### ============================================

### 31. Notification de commande prÃªte
POST {{baseUrl}}/whatsapp/send
Content-Type: {{contentType}}

{
  "to": "237699999999",
  "message": "ğŸ° Bonjour ! Votre commande #ORD-001 est prÃªte.\n\nğŸ“¦ DÃ©tails :\n- GÃ¢teau au chocolat x1\n- Tarte aux fruits x2\n\nMontant : 15 000 FCFA\n\nğŸ“ Ã€ rÃ©cupÃ©rer avant 18h.\nMerci ! ğŸ˜Š"
}

### 32. Confirmation de paiement
POST {{baseUrl}}/whatsapp/send
Content-Type: {{contentType}}

{
  "to": "237699999999",
  "message": "âœ… Paiement reÃ§u !\n\nMontant : 15 000 FCFA\nCommande : #ORD-001\nMÃ©thode : Mobile Money\n\nVotre commande sera prÃªte dans 2h.\nMerci pour votre confiance ! ğŸ™"
}

### 33. Rappel de retrait
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "â° Rappel : N'oubliez pas de rÃ©cupÃ©rer votre commande #ORD-001 avant 18h aujourd'hui.\n\nğŸ“ Adresse : [Votre adresse]\n\nÃ€ bientÃ´t ! ğŸ˜Š",
  "type": "TEXT",
  "scheduledAt": "{{$datetime iso8601 3600}}",
  "recipients": [
    {
      "recipient": "237699999999",
      "type": "PRIVATE"
    }
  ]
}

### 34. Message promotionnel (weekend)
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ‰ PROMOTION WEEKEND ! ğŸ‰\n\n-20% sur tous nos gÃ¢teaux ce samedi et dimanche !\n\nğŸ° GÃ¢teau chocolat : 8 000 â†’ 6 400 FCFA\nğŸ“ Tarte aux fraises : 10 000 â†’ 8 000 FCFA\nğŸ‚ GÃ¢teau anniversaire : 15 000 â†’ 12 000 FCFA\n\nRÃ©servez maintenant : ğŸ“ +237 6XX XXX XXX",
  "type": "TEXT",
  "scheduledAt": "2026-01-11T08:00:00Z",
  "recipients": [
    {
      "recipient": "237699999999",
      "type": "PRIVATE"
    },
    {
      "recipient": "237688888888",
      "type": "PRIVATE"
    }
  ]
}

### 35. Message de satisfaction client
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "Bonjour ! ğŸ˜Š\n\nVotre commande #ORD-001 vous a-t-elle satisfait ?\n\nVotre avis compte Ã©normÃ©ment pour nous !\n\nRÃ©pondez simplement :\nğŸ‘ = TrÃ¨s satisfait\nğŸ˜Š = Satisfait\nğŸ˜ = Peut mieux faire\n\nMerci ! ğŸ™",
  "type": "TEXT",
  "scheduledAt": "{{$datetime iso8601 86400}}",
  "recipients": [
    {
      "recipient": "237699999999",
      "type": "PRIVATE"
    }
  ]
}

### ============================================
### ğŸ§ª TESTS DE CHARGE
### ============================================

### 36. Envoyer 10 messages programmÃ©s en batch
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ“¢ Message de test en masse",
  "type": "TEXT",
  "scheduledAt": "{{$datetime iso8601 60}}",
  "recipients": [
    { "recipient": "237699999991", "type": "PRIVATE" },
    { "recipient": "237699999992", "type": "PRIVATE" },
    { "recipient": "237699999993", "type": "PRIVATE" },
    { "recipient": "237699999994", "type": "PRIVATE" },
    { "recipient": "237699999995", "type": "PRIVATE" },
    { "recipient": "237699999996", "type": "PRIVATE" },
    { "recipient": "237699999997", "type": "PRIVATE" },
    { "recipient": "237699999998", "type": "PRIVATE" },
    { "recipient": "237699999999", "type": "PRIVATE" },
    { "recipient": "237699999990", "type": "PRIVATE" }
  ]
}

### ============================================
### ğŸ› DEBUG & TROUBLESHOOTING
### ============================================

### 37. VÃ©rifier la santÃ© de l'API
GET {{baseUrl}}/health

### 38. Test de connexion simple
GET {{baseUrl}}/

### 39. Obtenir les logs rÃ©cents (si endpoint disponible)
GET {{baseUrl}}/whatsapp/logs?limit=20
### ============================================
### ğŸ“¢ STATUTS WHATSAPP (STORIES)
### ============================================

### 40. Publier un statut texte
POST {{baseUrl}}/whatsapp/status/text
Content-Type: {{contentType}}

{
  "message": "ğŸ‰ Nouvelle promotion cette semaine !"
}

### 41. Publier un statut image
POST {{baseUrl}}/whatsapp/status/image
Content-Type: {{contentType}}

{
  "imageUrl": "https://vscode.dev/github/ManichUser/patesserie-app-back/blob/main/test-images/cake.png",
  "caption": "ğŸ° -20% sur tous nos gÃ¢teaux ce weekend !"
}

### 42. Publier un statut vidÃ©o
POST {{baseUrl}}/whatsapp/status/video
Content-Type: {{contentType}}

{
  "videoUrl": "https://example.com/promo.mp4",
  "caption": "ğŸ¥ DÃ©couvrez notre nouvelle collection !"
}

### 43. Programmer un statut image
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ° Promo du jour !",
  "type": "STATUS",
  "mediaUrl": "https://example.com/gateaux.jpg",
  "scheduleInMinutes": 2,
  "recipients": []
}

### 44. Programmer un statut texte
POST {{baseUrl}}/whatsapp/scheduler
Content-Type: {{contentType}}

{
  "message": "ğŸ“¢ Ouverture demain Ã  8h !",
  "type": "STATUS",
  "scheduleInMinutes": 5,
  "recipients": []
}
### ============================================
### ğŸ“ NOTES
### ============================================
# - Remplacer {{baseUrl}} par votre URL en production
# - Remplacer les numÃ©ros de test par de vrais numÃ©ros
# - Les dates ISO8601 : "2026-01-08T15:00:00Z"
# - Format numÃ©ro : sans espaces ni + (ex: 237699999999)
# - Format groupe : XXXXXXXXX@g.us
# - {{$datetime iso8601 X}} = maintenant + X secondes
# ============================================